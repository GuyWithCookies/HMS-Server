<navbar></navbar>
<div class="container-fluid">
    <div class="row">
        <div class="col-xs-12 col-xs-offset-0 col-md-10 col-sm-offset-1">
            <uib-accordion>

                <div uib-accordion-group class="panel-default"
                     ng-repeat="user in userList track by $index">
                    <uib-accordion-heading>
                        <div>
                            <div ng-click="getEvents(user.username)" style="text-align: center;">
                                {{user.forename}} {{user.username}}
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </uib-accordion-heading>
                    <div class="well">
                        <div class="row">
                            <div class="col-sm-9">
                                <div class="btn-group">
                                    <button
                                            class="btn btn-primary"
                                            mwl-date-modifier
                                            date="viewDate"
                                            decrement="calendarView"
                                            ng-click="cellIsOpen = false">
                                        Zurück
                                    </button>
                                    <button
                                            class="btn btn-default"
                                            mwl-date-modifier
                                            date="viewDate"
                                            set-to-today
                                            ng-click="cellIsOpen = false">
                                        Heute
                                    </button>
                                    <button
                                            class="btn btn-primary"
                                            mwl-date-modifier
                                            date="viewDate"
                                            increment="calendarView"
                                            ng-click="cellIsOpen = false">
                                        Vor
                                    </button>
                                </div>

                                <div class="btn-group">
                                    <label class="btn btn-primary" ng-model="calendarView" uib-btn-radio="'year'"
                                           ng-click="cellIsOpen = false">Jahr</label>
                                    <label class="btn btn-primary" ng-model="calendarView" uib-btn-radio="'month'"
                                           ng-click="vm.cellIsOpen = false">Monat</label>
                                    <label class="btn btn-primary" ng-model="calendarView" uib-btn-radio="'week'"
                                           ng-click="vm.cellIsOpen = false">Woche</label>
                                    <label class="btn btn-primary" ng-model="calendarView" uib-btn-radio="'day'"
                                           ng-click="vm.cellIsOpen = false">Tag</label>
                                </div>
                            </div>
                            <div style="font-size: 2em;" class="col-sm-3">
                                <span class="pull-right glyphicon glyphicon-file"
                                      uib-tooltip="Erstelle einen Zeitplan als PDF zum Download oder als E-Mail
                                      (Woche, Monat, Jahr)"
                                      ng-click="openPDFModal(user)"
                                      tooltip-popup-delay="1000"></span>
                                <span class="glyphicon glyphicon-map-marker pull-right"
                                      uib-tooltip="Zeige die Positionen auf der Karte an"
                                      tooltip-popup-delay="1000"
                                      style="margin-right: 10px;"
                                      ng-click="openMapModal(user.username)"></span>
                            </div>
                        </div>
                    </div>


                    <mwl-calendar
                            events="events"
                            view="calendarView"
                            view-title="calendarTitle"
                            view-date="viewDate"
                            cell-is-open="cellIsOpen"
                            day-view-start="04:00"
                            day-view-end="20:00"
                            day-view-split="30"
                            cell-auto-open-disabled="true"
                    </mwl-calendar>
                </div>
            </uib-accordion>
        </div>
    </div>
</div>

<script type="text/ng-template" id="pdfGeneratorModal.html">
    <div class="modal-header">
        <h3 class="modal-title" id="title">
            Arbeitszeitnachweis für {{$pdf.docData.forename}} {{$pdf.username}} erstellen
        </h3>
    </div>
    <div class="modal-body col-sm-12" id="pdf">
        <form class="form-horizontal col-sm-8 col-sm-offset-2">
            <div class="form-group">
                <select name="timeRange" id="timeRange" ng-model="$pdf.docData.timeRange.range"
                        ng-change="$pdf.timeRangeChanged()">
                    <option value="">---Zeitraum---</option>
                    <option value="w">Woche</option>
                    <option value="m">Monat</option>
                    <option value="y">Jahr</option>
                </select>
            </div>
            <div class="form-group" style="padding-top: 1em;">
                <p class="input-group" ng-show="$pdf.datepicker.show">
                    <input type="text" class="form-control"
                           ng-change="$pdf.rstBtn();"
                           uib-datepicker-popup="{{$pdf.datepicker.format}}"
                           ng-model="$pdf.docData.timeRange.date"
                           is-open="$pdf.datepicker.opened" datepicker-options="dateOptions"
                           close-text="Abbrechen"
                           placeholder="konkreten Zeitraum auswählen"
                           ng-focus="$pdf.datepicker.opened = !$pdf.datepicker.opened"
                    />
                    <span class="input-group-btn">
                                <button type="button" class="btn btn-default"
                                        ng-click="$pdf.datepicker.opened = !$pdf.datepicker.opened">
                                <i class="glyphicon glyphicon-calendar"></i></button>
                            </span>
                </p>
            </div>
            <hr>
            <div class="form-group form-inline row col-sm-12">
                <label class="col-sm-6"><input type="checkbox" class="checkbox"
                              ng-change="$pdf.rstBtn();"
                              ng-model="$pdf.docData.coverSheet" style="padding-right: 2em">Deckblatt</label>
                <label class="col-sm-6"><input type="checkbox" class="checkbox"
                              ng-change="$pdf.rstBtn();"
                              ng-model="$pdf.docData.summary">Zusammenfassung</label>
            </div>
            <hr>
            <div class="form-group">
                <label class="radio-inline">
                    <input type="radio" name="optradio" ng-model="$pdf.docData.receiveType" value="saveOnClient">
                    Lokal speichern
                </label>
                <label class="radio-inline">
                    <input type="radio" name="optradio" ng-model="$pdf.docData.receiveType" value="email">
                    Per E-Mail senden
                </label>
            </div>
            <div class="form-group">
                <input type="email" ng-model="$pdf.docData.email" ng-show="$pdf.docData.receiveType==='email'"
                       placeholder="E-Mail Empfänger">
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <div class="alert alert-warning" ng-show="$pdf.errorMessage!==''">
            <span class="glyphicon glyphicon-info-sign"></span> {{$pdf.errorMessage}}</div>

        <a class="btn btn-success pull-right" href="../pdf/Arbeitszeitnachweis.pdf"
           ng-show="$pdf.downloadable">
            Download PDF
        </a>
        <button class="btn btn-primary pull-right" type="button" ng-show="!$pdf.downloadable"
                ng-click="$pdf.generatePDF()">Generieren</button>
        <button class="btn btn-danger pull-right" type="button" ng-click="$pdf.ok()">Abbrechen</button>
    </div>
</script>


<script type="text/ng-template" id="map.html">
    <div class="modal-header">
        <h3 class="modal-title" id="modal-title">Positionsanzeige für {{$ctrl.username}}</h3>
    </div>
    <div class="modal-body" id="modal-body">
        <ng-map zoom="14" center="[51.02, 13.72]" zoom-to-include-markers="auto"
                map-lazy-load="https://maps.google.com/maps/api/js"
                map-lazy-load-params="{{$ctrl.googleMapsUrl}}">
            <marker ng-repeat="p in $ctrl.positions" position="{{p.pos}}"></marker>

            <info-window id="iw">
                <div ng-non-bindable="">
                    Zeit: {{marker.time|date:'hh:mm:ss'}}
                </div>
            </info-window>
        </ng-map>
    </div>
    <div class="modal-footer">
        <p class="input-group">
            <input type="text" class="form-control" uib-datepicker-popup="dd MMMM yyyy"
                   ng-model="$ctrl.datepicker.date" ng-change="$ctrl.getGpsPositions()"
                   is-open="$ctrl.datepicker.opened" datepicker-options="dateOptions"
                   close-text="Abbrechen"
                   placeholder="Datum"
            />
            <span class="input-group-btn">
            <button type="button" class="btn btn-default" ng-click="$ctrl.datepicker.opened = !$ctrl.datepicker.opened">
                <i class="glyphicon glyphicon-calendar"></i></button>
          </span>
        </p>
        <div class="alert alert-warning" ng-show="$ctrl.errorMessage!==''">
            <span class="glyphicon glyphicon-info-sign"></span> {{$ctrl.errorMessage}}</div>
        <button class="btn btn-success pull-right" type="button" ng-click="$ctrl.ok()">Fertig</button>
    </div>
</script>